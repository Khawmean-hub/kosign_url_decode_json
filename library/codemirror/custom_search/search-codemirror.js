!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("./searchcursor"),require("../dialog/dialog")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../dialog/dialog"],e):e(CodeMirror)}(function(f){"use strict";function o(){this.posFrom=this.posTo=this.lastQuery=this.query=null,this.overlay=null}function p(e){return e.state.search||(e.state.search=new o)}function t(e){return"string"==typeof e&&e==e.toLowerCase()}function d(e,o,r){return e.getSearchCursor(o,r,{caseFold:t(o),multiline:!0})}function m(e,o,r,n,t){e.openDialog?e.openDialog(o,t,{value:n,selectValueOnOpen:!0,bottom:e.options.search.bottom}):t(prompt(r,n))}function y(e){return e.replace(/\\([nrt\\])/g,function(e,o){return"n"==o?"\n":"r"==o?"\r":"t"==o?"\t":"\\"==o?"\\":e})}function a(e){var o=e.match(/^\/(.*)\/([a-z]*)$/);if(o)try{e=new RegExp(o[1],-1==o[2].indexOf("i")?"":"i")}catch(e){}else e=y(e);return e=("string"==typeof e?""==e:e.test(""))?/x^/:e}function h(e,o,r){var n;o.queryText=r,o.query=a(r),e.removeOverlay(o.overlay,t(o.query)),o.overlay=(n=o.query,r=t(o.query),"string"==typeof n?n=new RegExp(n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),r?"gi":"g"):n.global||(n=new RegExp(n.source,n.ignoreCase?"gi":"g")),{token:function(e){n.lastIndex=e.pos;var o=n.exec(e.string);if(o&&o.index==e.pos)return e.pos+=o[0].length||1,"searching";o?e.pos=o.index:e.skipToEnd()}}),e.addOverlay(o.overlay),e.showMatchesOnScrollbar&&(o.annotate&&(o.annotate.clear(),o.annotate=null),o.annotate=e.showMatchesOnScrollbar(o.query,t(o.query)))}function r(t,o,e,r){var n=p(t);if(n.query)return g(t,o);var a,i,s,c,l,u=t.getSelection()||n.lastQuery;u instanceof RegExp&&"x^"==u.source&&(u=null),e&&t.openDialog?(a=null,i=function(e,o){f.e_stop(o),e&&(e!=n.queryText&&(h(t,n,e),n.posFrom=n.posTo=t.getCursor()),a&&(a.style.opacity=1),g(t,o.shiftKey,function(e,o){var r;o.line<3&&document.querySelector&&(r=t.display.wrapper.querySelector(".CodeMirror-dialog"))&&r.getBoundingClientRect().bottom-4>t.cursorCoords(o,"window").top&&((a=r).style.opacity=.4)}))},c=C(s=t),l=u,e=function(e,o){var r=f.keyName(e),n=t.getOption("extraKeys"),r=n&&n[r]||f.keyMap[t.getOption("keyMap")][r];"findNext"==r||"findPrev"==r||"findPersistentNext"==r||"findPersistentPrev"==r?(f.e_stop(e),h(t,p(t),o),t.execCommand(r)):"find"!=r&&"findPersistent"!=r||(f.e_stop(e),i(o,e))},s.openDialog(c,i,{value:l,selectValueOnOpen:!0,closeOnEnter:!1,onClose:function(){v(s)},onKeyDown:e,bottom:s.options.search.bottom}),r&&u&&(h(t,n,u),g(t,o))):m(t,C(t),"Search for:",u,function(e){e&&!n.query&&t.operation(function(){h(t,n,e),n.posFrom=n.posTo=t.getCursor(),g(t,o)})})}function g(r,n,t){r.operation(function(){var e=p(r),o=d(r,e.query,n?e.posFrom:e.posTo);(o.find(n)||(o=d(r,e.query,n?f.Pos(r.lastLine()):f.Pos(r.firstLine(),0))).find(n))&&(r.setSelection(o.from(),o.to()),r.scrollIntoView({from:o.from(),to:o.to()},20),e.posFrom=o.from(),e.posTo=o.to(),t&&t(o.from(),o.to()))})}function v(o){o.operation(function(){var e=p(o);e.lastQuery=e.query,e.query&&(e.query=e.queryText=null,o.removeOverlay(e.overlay),e.annotate&&(e.annotate.clear(),e.annotate=null))})}function x(e,o){var r,n=e?document.createElement(e):document.createDocumentFragment();for(r in o)n[r]=o[r];for(var t=2;t<arguments.length;t++){var a=arguments[t];n.appendChild("string"==typeof a?document.createTextNode(a):a)}return n}function C(e){return x("",null,x("span",{className:"CodeMirror-search-label"},e.phrase("Search:"))," ",x("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})," ",x("span",{style:"color: #888",className:"CodeMirror-search-hint"},e.phrase("(Use /re/ syntax for regexp search)")))}function q(o,n,t){o.operation(function(){for(var r,e=d(o,n);e.findNext();)"string"!=typeof n?(r=o.getRange(e.from(),e.to()).match(n),e.replace(t.replace(/\$(\d)/g,function(e,o){return r[o]}))):e.replace(t)})}function n(u,e){var o,r,n;u.getOption("readOnly")||(o=u.getSelection()||p(u).lastQuery,n=x("",null,x("span",{className:"CodeMirror-search-label"},r=e?u.phrase("Replace all:"):u.phrase("Replace:")),(n=u,x("",null," ",x("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})," ",x("span",{style:"color: #888",className:"CodeMirror-search-hint"},n.phrase("(Use /re/ syntax for regexp search)"))))),m(u,n,r,o,function(l){l&&(l=a(l),m(u,x("",null,x("span",{className:"CodeMirror-search-label"},u.phrase("With:"))," ",x("input",{type:"text",style:"width: 10em",className:"CodeMirror-search-field"})),u.phrase("Replace with:"),"",function(a){var i,s,c;a=y(a),e?q(u,l,a):(v(u),i=d(u,l,u.getCursor("from")),s=function(){var e,o,r,n,t=i.from();!(e=i.findNext())&&(i=d(u,l),!(e=i.findNext())||t&&i.from().line==t.line&&i.from().ch==t.ch)||(u.setSelection(i.from(),i.to()),u.scrollIntoView({from:i.from(),to:i.to()}),r=x("",null,x("span",{className:"CodeMirror-search-label"},(n=o=u).phrase("Replace?"))," ",x("button",{},n.phrase("Yes"))," ",x("button",{},n.phrase("No"))," ",x("button",{},n.phrase("All"))," ",x("button",{},n.phrase("Stop"))),t=u.phrase("Replace?"),n=[function(){c(e)},s,function(){q(u,l,a)}],o.openConfirm?o.openConfirm(r,n):confirm(t)&&n[0]())},c=function(r){i.replace("string"==typeof l?a:a.replace(/\$(\d)/g,function(e,o){return r[o]})),s()},s())}))}))}f.defineOption("search",{bottom:!1}),f.commands.find=function(e){v(e),r(e)},f.commands.findPersistent=function(e){v(e),r(e,!1,!0)},f.commands.findPersistentNext=function(e){r(e,!1,!0,!0)},f.commands.findPersistentPrev=function(e){r(e,!0,!0,!0)},f.commands.findNext=r,f.commands.findPrev=function(e){r(e,!0)},f.commands.clearSearch=v,f.commands.replace=n,f.commands.replaceAll=function(e){n(e,!0)}});
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(i){"use strict";var p,v,x=i.Pos;function m(t,e){for(var n,r,n=null!=(r=(n=t).flags)?r:(n.ignoreCase?"i":"")+(n.global?"g":"")+(n.multiline?"m":""),i=n,o=0;o<e.length;o++)-1==i.indexOf(e.charAt(o))&&(i+=e.charAt(o));return n==i?t:new RegExp(t.source,i)}function d(t){return/\\s|\\n|\n|\\W|\\D|\[\^/.test(t.source)}function a(t,e,n){e=m(e,"g");for(var r=n.line,i=n.ch,o=t.lastLine();r<=o;r++,i=0){e.lastIndex=i;var h=t.getLine(r),h=e.exec(h);if(h)return{from:x(r,h.index),to:x(r,h.index+h[0].length),match:h}}}function o(t,e,n){if(!d(e))return a(t,e,n);e=m(e,"gm");for(var r=1,i=n.line,o=t.lastLine();i<=o;){for(var h=0;h<r&&!(o<i);h++)var l=t.getLine(i++),c=null==c?l:c+"\n"+l;r*=2,e.lastIndex=n.ch;var s=e.exec(c);if(s){var f=c.slice(0,s.index).split("\n"),g=s[0].split("\n"),u=n.line+f.length-1,f=f[f.length-1].length;return{from:x(u,f),to:x(u+g.length-1,1==g.length?f+g[0].length:g[g.length-1].length),match:s}}}}function L(t,e,n){for(var r,i=0;i<=t.length;){e.lastIndex=i;var o=e.exec(t);if(!o)break;var h=o.index+o[0].length;if(h>t.length-n)break;(!r||h>r.index+r[0].length)&&(r=o),i=o.index+1}return r}function O(t,e,n){e=m(e,"g");for(var r=n.line,i=n.ch,o=t.firstLine();o<=r;r--,i=-1){var h=t.getLine(r),h=L(h,e,i<0?0:h.length-i);if(h)return{from:x(r,h.index),to:x(r,h.index+h[0].length),match:h}}}function h(t,e,n){if(!d(e))return O(t,e,n);e=m(e,"gm");for(var r=1,i=t.getLine(n.line).length-n.ch,o=n.line,h=t.firstLine();h<=o;){for(var l=0;l<r&&h<=o;l++)var c=t.getLine(o--),s=null==s?c:c+"\n"+s;r*=2;var f=L(s,e,i);if(f){var g=s.slice(0,f.index).split("\n"),u=f[0].split("\n"),a=o+g.length,g=g[g.length-1].length;return{from:x(a,g),to:x(a+u.length-1,1==u.length?g+u[0].length:u[u.length-1].length),match:f}}}}function y(t,e,n,r){if(t.length==e.length)return n;for(var i=0,o=n+Math.max(0,t.length-e.length);;){if(i==o)return i;var h=i+o>>1,l=r(t.slice(0,h)).length;if(l==n)return h;n<l?o=h:i=1+h}}function l(t,e,n,r){if(!e.length)return null;var i=r?p:v,o=i(e).split(/\r|\n\r?/);t:for(var h=n.line,l=n.ch,c=t.lastLine()+1-o.length;h<=c;h++,l=0){var s=t.getLine(h).slice(l),f=i(s);if(1==o.length){var g=f.indexOf(o[0]);if(-1!=g){n=y(s,f,g,i)+l;return{from:x(h,y(s,f,g,i)+l),to:x(h,y(s,f,g+o[0].length,i)+l)}}}else{var u=f.length-o[0].length;if(f.slice(u)==o[0]){for(var a=1;a<o.length-1;a++)if(i(t.getLine(h+a))!=o[a])continue t;var m=t.getLine(h+o.length-1),d=i(m),g=o[o.length-1];if(d.slice(0,g.length)==g)return{from:x(h,y(s,f,u,i)+l),to:x(h+o.length-1,y(m,d,g.length,i))}}}}}function c(t,e,n,r){if(!e.length)return null;var i=r?p:v,o=i(e).split(/\r|\n\r?/);t:for(var h=n.line,l=n.ch,c=t.firstLine()-1+o.length;c<=h;h--,l=-1){var s=t.getLine(h),f=i(s=-1<l?s.slice(0,l):s);if(1==o.length){var g=f.lastIndexOf(o[0]);if(-1!=g)return{from:x(h,y(s,f,g,i)),to:x(h,y(s,f,g+o[0].length,i))}}else{var u=o[o.length-1];if(f.slice(0,u.length)==u){for(var a=1,n=h-o.length+1;a<o.length-1;a++)if(i(t.getLine(n+a))!=o[a])continue t;var m=t.getLine(h+1-o.length),g=i(m);if(g.slice(g.length-o[0].length)==o[0])return{from:x(h+1-o.length,y(m,g,m.length-o[0].length,i)),to:x(h,y(s,f,u.length,i))}}}}}function r(n,r,t,e){var i;this.atOccurrence=!1,this.afterEmptyMatch=!1,this.doc=n,t=t?n.clipPos(t):x(0,0),this.pos={from:t,to:t},"object"==typeof e?i=e.caseFold:(i=e,e=null),"string"==typeof r?(null==i&&(i=!1),this.matches=function(t,e){return(t?c:l)(n,r,e,i)}):(r=m(r,"gm"),e&&!1===e.multiline?this.matches=function(t,e){return(t?O:a)(n,r,e)}:this.matches=function(t,e){return(t?h:o)(n,r,e)})}v=String.prototype.normalize?(p=function(t){return t.normalize("NFD").toLowerCase()},function(t){return t.normalize("NFD")}):(p=function(t){return t.toLowerCase()},function(t){return t}),r.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){var e=this.doc.clipPos(t?this.pos.from:this.pos.to);if(this.afterEmptyMatch&&this.atOccurrence&&(e=x(e.line,e.ch),t?(e.ch--,e.ch<0&&(e.line--,e.ch=(this.doc.getLine(e.line)||"").length)):(e.ch++,e.ch>(this.doc.getLine(e.line)||"").length&&(e.ch=0,e.line++)),0!=i.cmpPos(e,this.doc.clipPos(e))))return this.atOccurrence=!1;e=this.matches(t,e);if(this.afterEmptyMatch=e&&0==i.cmpPos(e.from,e.to),e)return this.pos=e,this.atOccurrence=!0,this.pos.match||!0;t=x(t?this.doc.firstLine():this.doc.lastLine()+1,0);return this.pos={from:t,to:t},this.atOccurrence=!1},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(t,e){this.atOccurrence&&(t=i.splitLines(t),this.doc.replaceRange(t,this.pos.from,this.pos.to,e),this.pos.to=x(this.pos.from.line+t.length-1,t[t.length-1].length+(1==t.length?this.pos.from.ch:0)))}},i.defineExtension("getSearchCursor",function(t,e,n){return new r(this.doc,t,e,n)}),i.defineDocExtension("getSearchCursor",function(t,e,n){return new r(this,t,e,n)}),i.defineExtension("selectMatches",function(t,e){for(var n=[],r=this.getSearchCursor(t,this.getCursor("from"),e);r.findNext()&&!(0<i.cmpPos(r.to(),this.getCursor("to")));)n.push({anchor:r.from(),head:r.to()});n.length&&this.setSelections(n,0)})});
!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(s){function f(e,o,n){var t=e.getWrapperElement(),e=t.appendChild(document.createElement("div"));return e.className=n?"CodeMirror-dialog CodeMirror-dialog-bottom":"CodeMirror-dialog CodeMirror-dialog-top","string"==typeof o?e.innerHTML=o:e.appendChild(o),s.addClass(t,"dialog-opened"),e}function p(e,o){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=o}s.defineExtension("openDialog",function(e,o,n){n=n||{},p(this,null);var t=f(this,e,n.bottom),i=!1,r=this;function u(e){"string"==typeof e?l.value=e:i||(i=!0,s.rmClass(t.parentNode,"dialog-opened"),t.parentNode.removeChild(t),r.focus(),n.onClose&&n.onClose(t))}var l=t.getElementsByTagName("input")[0];return l?(l.focus(),n.value&&(l.value=n.value,!1!==n.selectValueOnOpen&&l.select()),n.onInput&&s.on(l,"input",function(e){n.onInput(e,l.value,u)}),n.onKeyUp&&s.on(l,"keyup",function(e){n.onKeyUp(e,l.value,u)}),s.on(l,"keydown",function(e){n&&n.onKeyDown&&n.onKeyDown(e,l.value,u)||((27==e.keyCode||!1!==n.closeOnEnter&&13==e.keyCode)&&(l.blur(),s.e_stop(e),u()),13==e.keyCode&&o(l.value,e))}),!1!==n.closeOnBlur&&s.on(t,"focusout",function(e){null!==e.relatedTarget&&u()})):(e=t.getElementsByTagName("button")[0])&&(s.on(e,"click",function(){u(),r.focus()}),!1!==n.closeOnBlur&&s.on(e,"blur",u),e.focus()),u}),s.defineExtension("openConfirm",function(e,o,n){p(this,null);var t=f(this,e,n&&n.bottom),i=t.getElementsByTagName("button"),r=!1,u=this,l=1;function a(){r||(r=!0,s.rmClass(t.parentNode,"dialog-opened"),t.parentNode.removeChild(t),u.focus())}i[0].focus();for(var c=0;c<i.length;++c){var d=i[c];!function(o){s.on(d,"click",function(e){s.e_preventDefault(e),a(),o&&o(u)})}(o[c]),s.on(d,"blur",function(){--l,setTimeout(function(){l<=0&&a()},200)}),s.on(d,"focus",function(){++l})}}),s.defineExtension("openNotification",function(e,o){p(this,r);var n,t=f(this,e,o&&o.bottom),i=!1,o=o&&void 0!==o.duration?o.duration:5e3;function r(){i||(i=!0,clearTimeout(n),s.rmClass(t.parentNode,"dialog-opened"),t.parentNode.removeChild(t))}return s.on(t,"click",function(e){s.e_preventDefault(e),r()}),o&&(n=setTimeout(r,o)),r})});
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e){function i(t){clearTimeout(n.doRedraw),n.doRedraw=setTimeout(function(){n.redraw()},t)}this.cm=t,this.options=e,this.buttonHeight=e.scrollButtonHeight||t.getOption("scrollButtonHeight"),this.annotations=[],this.doRedraw=this.doUpdate=null,this.div=t.getWrapperElement().appendChild(document.createElement("div")),this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none",this.computeScale();var n=this;t.on("refresh",this.resizeHandler=function(){clearTimeout(n.doUpdate),n.doUpdate=setTimeout(function(){n.computeScale()&&i(20)},100)}),t.on("markerAdded",this.resizeHandler),t.on("markerCleared",this.resizeHandler),!1!==e.listenForChanges&&t.on("changes",this.changeHandler=function(){i(250)})}t.defineExtension("annotateScrollbar",function(t){return new e(this,t="string"==typeof t?{className:t}:t)}),t.defineOption("scrollButtonHeight",0),e.prototype.computeScale=function(){var t=this.cm,t=(t.getWrapperElement().clientHeight-t.display.barHeight-2*this.buttonHeight)/t.getScrollerElement().scrollHeight;if(t!=this.hScale)return this.hScale=t,!0},e.prototype.update=function(t){this.annotations=t,this.redraw()},e.prototype.redraw=function(t){!1!==t&&this.computeScale();var n=this.cm,e=this.hScale,i=document.createDocumentFragment(),o=this.annotations,r=n.getOption("lineWrapping"),a=r&&1.5*n.defaultTextHeight(),s=null,h=null;function l(t,e){var i;return s!=t.line&&(s=t.line,h=n.getLineHandle(t.line),(i=n.getLineHandleVisualStart(h))!=h&&(s=n.getLineNumber(i),h=i)),h.widgets&&h.widgets.length||r&&h.height>a?n.charCoords(t,"local")[e?"top":"bottom"]:n.heightAtLine(h,"local")+(e?0:h.height)}var d=n.lastLine();if(n.display.barWidth)for(var c,p=0;p<o.length;p++){var u=o[p];if(!(u.to.line>d)){for(var m,f,g=c||l(u.from,!0)*e,H=l(u.to,!1)*e;p<o.length-1&&!(o[p+1].to.line>d)&&!(H+.9<(c=l(o[p+1].from,!0)*e));)H=l((u=o[++p]).to,!1)*e;H!=g&&(m=Math.max(H-g,3),(f=i.appendChild(document.createElement("div"))).style.cssText="position: absolute; right: 0px; width: "+Math.max(n.display.barWidth-1,2)+"px; top: "+(g+this.buttonHeight)+"px; height: "+m+"px",f.className=this.options.className,u.id&&f.setAttribute("annotation-id",u.id))}}this.div.textContent="",this.div.appendChild(i)},e.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler),this.cm.off("markerAdded",this.resizeHandler),this.cm.off("markerCleared",this.resizeHandler),this.changeHandler&&this.cm.off("changes",this.changeHandler),this.div.parentNode.removeChild(this.div)}});
!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("./searchcursor"),require("../scroll/annotatescrollbar")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","./searchcursor","../scroll/annotatescrollbar"],t):t(CodeMirror)}(function(h){"use strict";function o(t,e,i,o){this.cm=t;var n,s={listenForChanges:!1};for(n in this.options=o)s[n]=o[n];s.className||(s.className="CodeMirror-search-match"),this.annotation=t.annotateScrollbar(s),this.query=e,this.caseFold=i,this.gap={from:t.firstLine(),to:t.lastLine()+1},this.matches=[],this.update=null,this.findMatches(),this.annotation.update(this.matches);var a=this;t.on("change",this.changeHandler=function(t,e){a.onChange(e)})}h.defineExtension("showMatchesOnScrollbar",function(t,e,i){return new o(this,t,e,i=(i="string"==typeof i?{className:i}:i)||{})});function c(t,e,i){return t<=e?t:Math.max(e,t+i)}o.prototype.findMatches=function(){if(this.gap){for(var t=0;t<this.matches.length;t++){if((e=this.matches[t]).from.line>=this.gap.to)break;e.to.line>=this.gap.from&&this.matches.splice(t--,1)}for(var e,i=this.cm.getSearchCursor(this.query,h.Pos(this.gap.from,0),{caseFold:this.caseFold,multiline:this.options.multiline}),o=this.options&&this.options.maxMatches||1e3;i.findNext();){if((e={from:i.from(),to:i.to()}).from.line>=this.gap.to)break;if(this.matches.splice(t++,0,e),this.matches.length>o)break}this.gap=null}},o.prototype.onChange=function(t){var e=t.from.line,i=h.changeEnd(t).line,o=i-t.to.line;if(this.gap?(this.gap.from=Math.min(c(this.gap.from,e,o),t.from.line),this.gap.to=Math.max(c(this.gap.to,e,o),t.from.line)):this.gap={from:t.from.line,to:i+1},o)for(var n=0;n<this.matches.length;n++){var s=this.matches[n],a=c(s.from.line,e,o);a!=s.from.line&&(s.from=h.Pos(a,s.from.ch));a=c(s.to.line,e,o);a!=s.to.line&&(s.to=h.Pos(a,s.to.ch))}clearTimeout(this.update);var r=this;this.update=setTimeout(function(){r.updateAfterChange()},250)},o.prototype.updateAfterChange=function(){this.findMatches(),this.annotation.update(this.matches)},o.prototype.clear=function(){this.cm.off("change",this.changeHandler),this.annotation.clear()}});